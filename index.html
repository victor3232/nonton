<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DramaBox Nonton - Unofficial Streaming Sederhana</title>
    <style>
        body { font-family: Arial, sans-serif; background: #121212; color: #fff; margin: 0; padding: 0; }
        header { background: #1f1f1f; padding: 20px; text-align: center; }
        h1 { margin: 0; }
        #search-bar { padding: 20px; text-align: center; }
        input[type="text"] { padding: 10px; width: 80%; max-width: 500px; border-radius: 5px; border: none; }
        button { padding: 10px 20px; background: #ff4444; color: #fff; border: none; border-radius: 5px; cursor: pointer; }
        #drama-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; padding: 20px; }
        .drama-card { background: #1f1f1f; border-radius: 10px; overflow: hidden; cursor: pointer; transition: transform 0.2s; }
        .drama-card:hover { transform: scale(1.05); }
        .drama-card img { width: 100%; height: 300px; object-fit: cover; }
        .drama-info { padding: 10px; text-align: center; }
        .drama-info h3 { margin: 10px 0 5px; font-size: 16px; }
        .drama-info p { margin: 5px 0; font-size: 14px; color: #aaa; }
        #detail-page { display: none; padding: 20px; }
        #episode-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px; margin-top: 20px; }
        .episode-btn { background: #333; padding: 15px; text-align: center; border-radius: 5px; cursor: pointer; }
        .episode-btn:hover { background: #ff4444; }
        #player { width: 100%; max-width: 800px; margin: 20px auto; }
        video { width: 100%; height: auto; background: #000; }
        .back-btn { background: #333; padding: 10px 20px; cursor: pointer; display: inline-block; margin-bottom: 20px; border-radius: 5px; }
        .loading { text-align: center; padding: 20px; }
        footer { text-align: center; padding: 20px; background: #1f1f1f; font-size: 12px; color: #aaa; }
    </style>
</head>
<body>

    <header>
        <h1>DramaBox Nonton Sederhana</h1>
        <p>Unofficial - Gunakan API dari https://dramabox-asia.vercel.app</p>
    </header>

    <div id="home-page">
        <div id="search-bar">
            <input type="text" id="search-input" placeholder="Cari judul drama (misal: CEO)">
            <button onclick="searchDrama()">Cari</button>
            <button onclick="loadTrending()" style="margin-left:10px;">Trending</button>
            <button onclick="loadLatest(1)" style="margin-left:10px;">Terbaru</button>
        </div>

        <div id="drama-list" class="loading">Loading drama populer...</div>
    </div>

    <div id="detail-page">
        <div class="back-btn" onclick="backToHome()">‚Üê Kembali</div>
        <div id="drama-detail"></div>
        <h2>Episode</h2>
        <div id="episode-list"></div>
        <div id="player"></div>
    </div>

    <footer>
        Ini adalah website sederhana unofficial untuk nonton short drama dari DramaBox menggunakan API publik.<br>
        Tidak menyimpan video apa pun. Semua konten dari sumber eksternal.<br>
        Dibuat untuk keperluan pribadi/eksperimen.
    </footer>

    <script>
        const API_BASE = 'https://dramabox-asia.vercel.app/api';

        function backToHome() {
            document.getElementById('home-page').style.display = 'block';
            document.getElementById('detail-page').style.display = 'none';
            document.getElementById('player').innerHTML = '';
        }

        function loadTrending() {
            document.getElementById('drama-list').innerHTML = '<div class="loading">Loading trending...</div>';
            fetch(`${API_BASE}/trending`)
                .then(res => res.json())
                .then(data => displayDramas(data.data || []))
                .catch(err => alert('Error loading trending: ' + err));
        }

        function loadLatest(page = 1) {
            document.getElementById('drama-list').innerHTML = '<div class="loading">Loading terbaru...</div>';
            fetch(`${API_BASE}/latest?page=${page}`)
                .then(res => res.json())
                .then(data => displayDramas(data.data || []))
                .catch(err => alert('Error: ' + err));
        }

        function searchDrama() {
            const q = document.getElementById('search-input').value.trim();
            if (!q) return alert('Masukkan kata kunci!');
            document.getElementById('drama-list').innerHTML = '<div class="loading">Mencari...</div>';
            fetch(`${API_BASE}/search?q=${encodeURIComponent(q)}`)
                .then(res => res.json())
                .then(data => displayDramas(data.data || []))
                .catch(err => alert('Error search: ' + err));
        }

        function displayDramas(dramas) {
            if (dramas.length === 0) {
                document.getElementById('drama-list').innerHTML = '<p>Tidak ditemukan drama.</p>';
                return;
            }
            let html = '';
            dramas.forEach(drama => {
                const cover = drama.cover || 'https://via.placeholder.com/240x400?text=No+Cover';
                html += `
                    <div class="drama-card" onclick="showDetail('${drama.bookId}')">
                        <img src="${cover}" alt="${drama.judul}">
                        <div class="drama-info">
                            <h3>${drama.judul || 'Unknown'}</h3>
                            <p>${drama.total_episode || '?? ep'}</p>
                        </div>
                    </div>`;
            });
            document.getElementById('drama-list').innerHTML = html;
        }

        function showDetail(bookId) {
            fetch(`${API_BASE}/detail?bookId=${bookId}`)
                .then(res => res.json())
                .then(data => {
                    const drama = data.data || {};
                    let detailHtml = `
                        <h2>${drama.judul || 'Unknown'}</h2>
                        <img src="${drama.cover || ''}" style="max-width:300px; border-radius:10px;">
                        <p><strong>Total Episode:</strong> ${drama.total_episode || '??'}</p>
                        <p>${drama.description || 'Tidak ada deskripsi.'}</p>`;
                    document.getElementById('drama-detail').innerHTML = detailHtml;

                    // Buat list episode (asumsi total_episode seperti "50 ep")
                    const totalEp = parseInt(drama.total_episode) || 50;
                    let epHtml = '';
                    for (let i = 1; i <= totalEp; i++) {
                        epHtml += `<div class="episode-btn" onclick="playEpisode('${bookId}', ${i})">Episode ${i}</div>`;
                    }
                    document.getElementById('episode-list').innerHTML = epHtml;

                    document.getElementById('home-page').style.display = 'none';
                    document.getElementById('detail-page').style.display = 'block';
                })
                .catch(err => alert('Error detail: ' + err));
        }

        function playEpisode(bookId, episode) {
            document.getElementById('player').innerHTML = '<div class="loading">Loading video...</div>';
            fetch(`${API_BASE}/stream?bookId=${bookId}&episode=${episode}`)
                .then(res => res.json())
                .then(data => {
                    const videoUrl = data.video_url || data.stream_url || data.url; // Sesuaikan berdasarkan response actual
                    if (!videoUrl) {
                        document.getElementById('player').innerHTML = '<p>Video tidak tersedia atau error.</p>';
                        return;
                    }
                    const playerHtml = `
                        <h3>Sedang memutar Episode ${episode}</h3>
                        <video controls autoplay>
                            <source src="${videoUrl}" type="video/mp4">
                            Browser Anda tidak support video.
                        </video>`;
                    document.getElementById('player').innerHTML = playerHtml;
                })
                .catch(err => {
                    document.getElementById('player').innerHTML = '<p>Error loading stream: ' + err + '</p>';
                });
        }

        // Load trending saat pertama buka
        window.onload = loadTrending;
    </script>

</body>
</html>
